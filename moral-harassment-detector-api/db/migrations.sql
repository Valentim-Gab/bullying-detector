CREATE TABLE USERS (
	ID SERIAL PRIMARY KEY,
	NAME VARCHAR(100) NOT NULL,
	LAST_NAME VARCHAR(100),
	EMAIL VARCHAR(100) UNIQUE NOT NULL,
	PASSWORD TEXT NOT NULL,
	DATE_BIRTH DATE,
	PHONE_NUMBER VARCHAR(25),
	ROLE varchar(10)[],
	AVATAR TEXT,
	VERIFIED_EMAIL BOOLEAN DEFAULT FALSE
);

CREATE TABLE DETECTION (
	ID_DETECTION SERIAL PRIMARY KEY,
	RECORDING_AUDIO TEXT NOT NULL,
	RECORDING_TRANSCRIBED TEXT NOT NULL,
	MISTRAL_RESULT BOOLEAN,
	MISTRAL_MESSAGE TEXT,
	COHERE_RESULT BOOLEAN,
	COHERE_MESSAGE TEXT,
	DATABASE_RESULT BOOLEAN,
	DATABASE_ID_PHRASE INT,
	DATABASE_USER_DETECT BOOLEAN DEFAULT FALSE,
	DATABASE_APPROVE_USER_LIST VARCHAR(100)[],
	DATABASE_REJECT_USER_LIST VARCHAR(100)[],
	SIMILARITY_RESULT BOOLEAN
);

CREATE TABLE HARASSMENT_PHRASE (
	ID_PHRASE SERIAL PRIMARY KEY,
	PHRASE VARCHAR(100),
	USER_DETECT BOOLEAN DEFAULT FALSE,
	APPROVE_USER_LIST VARCHAR(100)[],
	REJECT_USER_LIST VARCHAR(100)[]
);

SELECT 
	CASE WHEN EXISTS (
		SELECT 1
		FROM harassment_phrase
		WHERE 'Cara, você é um inútil' ILIKE CONCAT('%', phrase, '%')
	) THEN TRUE
	ELSE FALSE
END AS harassment_detected;
